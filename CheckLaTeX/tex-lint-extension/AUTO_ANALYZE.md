# Автоматический анализ при сохранении LaTeX файлов

## Обзор

CheckLaTeX Extension поддерживает автоматический анализ LaTeX документов при сохранении. Эта функция позволяет мгновенно получать обратную связь о качестве кода без необходимости ручного запуска анализа.

## Настройки

### Основные параметры

- **`checklatex.autoAnalyze`** (boolean, по умолчанию: `false`)
  - Включает/выключает автоматический анализ при сохранении
  - Можно быстро переключать через команду "Toggle Auto Analyze on Save"

- **`checklatex.autoAnalyzeScope`** (enum, по умолчанию: `"current"`)
  - `"current"` - анализировать только сохраненный файл
  - `"project"` - анализировать весь LaTeX проект при сохранении любого .tex файла

- **`checklatex.autoAnalyzeDelay`** (number, по умолчанию: `1000` мс = 1 секунда)
  - Задержка перед началом анализа после сохранения
  - Минимальное значение: 0 мс (мгновенный анализ)
  - Максимальное значение: 10 секунд (10000 мс)
  - Полезно для предотвращения частых запросов при быстром сохранении файлов

- **`checklatex.autoAnalyzeShowNotification`** (boolean, по умолчанию: `true`)
  - Показывать уведомления о результатах автоматического анализа
  - При отключении результаты записываются только в канал вывода

## Использование

### Включение автоматического анализа

1. **Через настройки VS Code:**
   - Откройте настройки (Ctrl+,)
   - Найдите "CheckLaTeX"
   - Включите "Auto Analyze"

2. **Через команду:**
   - Откройте палитру команд (Ctrl+Shift+P)
   - Найдите "CheckLaTeX: Toggle Auto Analyze on Save"
   - Выполните команду

3. **Через JSON настройки:**
   ```json
   {
     "checklatex.autoAnalyze": true
   }
   ```

### Работа с задержкой

Задержка анализа помогает:
- Избежать множественных запросов при быстром сохранении
- Дать время для завершения автосохранения VS Code
- Снизить нагрузку на сервер

```json
{
  "checklatex.autoAnalyzeDelay": 2000  // 2 секунды задержки
}
```

## Поведение системы

### Умное управление таймерами
- Каждый файл имеет свой независимый таймер
- При повторном сохранении файла старый таймер отменяется
- Это предотвращает накопление отложенных анализов

### Логирование
Все автоматические анализы записываются в канал вывода "CheckLaTeX":
```
=== Автоматический анализ при сохранении (14:30:25) ===
Файл: C:\Project\document.tex
Область: текущий файл
=== Автоматический анализ завершен ===
```

### Обработка ошибок
- Ошибки автоматического анализа не останавливают работу редактора
- При включенных уведомлениях показываются всплывающие сообщения
- Подробная информация записывается в канал вывода

## Примеры конфигурации

### Быстрая обратная связь
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeScope": "current",
  "checklatex.autoAnalyzeDelay": 500,
  "checklatex.autoAnalyzeShowNotification": true
}
```

### Анализ всего проекта
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeScope": "project",
  "checklatex.autoAnalyzeDelay": 2000,
  "checklatex.autoAnalyzeShowNotification": false
}
```

### Минималистичная настройка
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeScope": "current",
  "checklatex.autoAnalyzeDelay": 0,
  "checklatex.autoAnalyzeShowNotification": false
}
```

## Интеграция с другими функциями

### Совместимость с периодической проверкой
- Автоматический анализ при сохранении работает независимо от периодической проверки
- Обе функции могут быть включены одновременно
- При сохранении файла сначала срабатывает автоанализ, затем по расписанию - периодическая проверка

### Диагностика
- Результаты автоматического анализа обновляют диагностики VS Code
- Ошибки подсвечиваются в редакторе с помощью squiggles
- Диагностики остаются до следующего анализа или ручной очистки

### Статус-бар
- Во время автоматического анализа (если включены уведомления) статус-бар показывает прогресс
- После завершения показывается результат на 3 секунды

## Сценарии использования

### Активная разработка
Для получения мгновенной обратной связи:
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeScope": "current",
  "checklatex.autoAnalyzeDelay": 1000
}
```

### Работа с большими проектами
Для комплексной проверки при каждом сохранении:
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeScope": "project",
  "checklatex.autoAnalyzeDelay": 3000,
  "checklatex.autoAnalyzeShowNotification": false
}
```

### Тихий режим
Для работы без отвлекающих уведомлений:
```json
{
  "checklatex.autoAnalyze": true,
  "checklatex.autoAnalyzeShowNotification": false
}
```

## Советы по оптимизации

### Производительность
1. **Для больших проектов** используйте `autoAnalyzeScope: "current"` и большую задержку
2. **При медленной сети** увеличьте `autoAnalyzeDelay` до 3-5 секунд
3. **При частом сохранении** используйте задержку минимум 1 секунда

### Удобство использования
1. **Отключите уведомления** если анализ происходит слишком часто
2. **Используйте анализ проекта** только для финальной проверки
3. **Комбинируйте** с периодической проверкой для максимального покрытия

## Устранение неполадок

### Проблема: Анализ не запускается при сохранении
- Проверьте, что `checklatex.autoAnalyze` установлен в `true`
- Убедитесь, что сохраняете .tex файл (расширение .tex, .latex, .ltx)
- Проверьте канал вывода "CheckLaTeX" на наличие ошибок

### Проблема: Слишком частые анализы
- Увеличьте `autoAnalyzeDelay`
- Рассмотрите отключение `autoAnalyzeShowNotification`
- При работе с включенным автосохранением VS Code установите задержку 2-3 секунды

### Проблема: Анализ не завершается
- Проверьте доступность сервера CheckLaTeX
- Увеличьте таймаут в настройках `timeout`
- Проверьте размер анализируемых файлов

## Команды

- `checklatex.toggleAutoAnalyze` - Переключить автоматический анализ при сохранении
- `checklatex.analyzeCurrentFile` - Принудительно анализировать текущий файл
- `checklatex.clearDiagnostics` - Очистить диагностики

## Взаимодействие с VS Code

### Автосохранение
При включенном автосохранении VS Code (`"files.autoSave": "on"`) рекомендуется:
- Установить задержку минимум 2 секунды
- Отключить уведомления для уменьшения шума
- Использовать только анализ текущего файла

### Форматирование
Автоматический анализ совместим с:
- LaTeX Workshop автоформатированием
- Prettier для LaTeX
- Другими расширениями форматирования

Рекомендуется устанавливать задержку после форматирования для получения актуальных результатов анализа. 